<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Configuration - 42 Webserv</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        pre {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            border: 1px solid #ddd;
        }

        pre code {
            white-space: pre;
        }

        .config-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .config-section h3 {
            color: #2c3e50;
            margin-top: 25px;
        }

        .config-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
        }

        .config-tab {
            padding: 10px 15px;
            cursor: pointer;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-bottom: none;
            margin-right: 5px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }

        .config-tab.active {
            background-color: #fff;
            border-bottom: 1px solid #fff;
            margin-bottom: -1px;
            font-weight: bold;
        }

        .config-content {
            display: none;
        }

        .config-content.active {
            display: block;
        }

        .keyword {
            color: #0066cc;
            font-weight: bold;
        }

        .comment {
            color: #999;
            font-style: italic;
        }

        .value {
            color: #c7254e;
        }

        .directive {
            color: #2e6da4;
        }

        .note {
            background-color: #fffde7;
            padding: 10px 15px;
            border-left: 4px solid #ffd600;
            margin: 15px 0;
        }

        .warning {
            background-color: #fff3e0;
            padding: 10px 15px;
            border-left: 4px solid #ff9800;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <header>
        <h1>Server Configuration</h1>
        <p>How to set up and configure your Webserv instance</p>
    </header>

    <nav>
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/images/">Images</a></li>
            <li><a href="/docs/">Documents</a></li>
            <li><a href="/docs/about.html">About</a></li>
        </ul>
    </nav>

    <div class="container">
        <main>
            <section class="blog-post">
                <h2>Server Configuration Guide</h2>
                <p>
                    This page provides examples and explanation of how to configure your Webserv server.
                    Configuration files define how the server behaves, what content it serves, and how it
                    processes requests. Below are examples of common configurations.
                </p>
            </section>

            <section class="config-section">
                <h3>CGI Configuration</h3>
                <p>
                    <strong>Common Gateway Interface (CGI)</strong> allows the server to execute scripts and programs
                    and return their output to clients. Unlike static files, CGI must be specifically configured
                    to work properly. Here's how to configure CGI in Webserv:
                </p>

                <div class="config-tabs">
                    <div class="config-tab active" onclick="switchTab(event, 'basic-cgi')">Basic CGI Setup</div>
                    <div class="config-tab" onclick="switchTab(event, 'advanced-cgi')">Advanced CGI</div>
                </div>

                <div id="basic-cgi" class="config-content active">
                    <pre><code><span class="comment"># Basic CGI configuration in a server block</span>
<span class="keyword">server</span> {
    <span class="directive">listen</span> <span class="value">8080</span>
    <span class="directive">server_name</span> <span class="value">example.com</span>
    <span class="directive">root</span> <span class="value">/path/to/webroot</span>

    <span class="comment"># Map file extensions to interpreters</span>
    <span class="directive">cgi</span> <span class="value">.py:/usr/bin/python3</span>
    <span class="directive">cgi</span> <span class="value">.php:/usr/bin/php-cgi</span>

    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/cgi-bin</span>
        <span class="directive">root</span> <span class="value">/path/to/webroot/cgi-bin</span>
        <span class="directive">methods</span> <span class="value">GET POST</span>
        <span class="comment"># Allow CGI execution in this location</span>
        <span class="directive">cgi</span> <span class="value">.py:/usr/bin/python3</span>
    }
}</code></pre>
                    <div class="note">
                        <p><strong>Note:</strong> Make sure your CGI scripts have execute permissions (chmod +x) and
                        contain the proper shebang line (#!/usr/bin/env python3) at the beginning of the file.</p>
                    </div>
                </div>

                <div id="advanced-cgi" class="config-content">
                    <pre><code><span class="comment"># Advanced CGI configuration with multiple interpreters and limits</span>
<span class="directive">max_concurrent_cgi</span> <span class="value">10</span> <span class="comment"># Maximum number of concurrent CGI processes</span>
<span class="directive">max_cgi_backlog</span> <span class="value">100</span> <span class="comment"># Maximum backlog size for CGI requests</span>

<span class="keyword">server</span> {
    <span class="directive">listen</span> <span class="value">8080</span>
    <span class="directive">server_name</span> <span class="value">example.com</span>
    <span class="directive">root</span> <span class="value">/path/to/webroot</span>
    <span class="directive">client_body_size</span> <span class="value">5M</span> <span class="comment"># Maximum upload size</span>

    <span class="comment"># Global CGI configuration</span>
    <span class="directive">cgi</span> <span class="value">.py:/usr/bin/python3</span>
    <span class="directive">cgi</span> <span class="value">.php:/usr/bin/php-cgi</span>
    <span class="directive">cgi</span> <span class="value">.pl:/usr/bin/perl</span>

    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/scripts</span>
        <span class="directive">root</span> <span class="value">/path/to/webroot/scripts</span>
        <span class="directive">methods</span> <span class="value">GET POST</span>
        <span class="comment"># Override global CGI configuration for specific extensions</span>
        <span class="directive">cgi</span> <span class="value">.py:/usr/local/bin/python3.9</span>
    }

    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/uploads</span>
        <span class="directive">root</span> <span class="value">/path/to/webroot/uploads</span>
        <span class="directive">methods</span> <span class="value">GET POST PUT</span>
        <span class="directive">upload</span> <span class="value">1</span> <span class="comment"># Enable file uploads in this location</span>
        <span class="directive">cgi</span> <span class="value">.php:/usr/bin/php8.1-cgi</span> <span class="comment"># PHP 8.1 handler for processing uploads</span>
    }
}</code></pre>
                    <div class="warning">
                        <p><strong>Warning:</strong> Setting high values for max_concurrent_cgi can consume significant
                        system resources. Monitor your server's performance and adjust accordingly.</p>
                    </div>
                </div>
            </section>

            <section class="config-section">
                <h3>Virtual Hosts & Multiple Servers</h3>
                <p>
                    Webserv supports multiple virtual hosts, allowing you to serve different content
                    based on the domain name or IP address used to access the server.
                </p>

                <pre><code><span class="comment"># Configuration with multiple virtual hosts</span>
<span class="keyword">server</span> {
    <span class="directive">listen</span> <span class="value">80</span>
    <span class="directive">server_name</span> <span class="value">example.com www.example.com</span>
    <span class="directive">root</span> <span class="value">/path/to/example</span>

    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/</span>
        <span class="directive">root</span> <span class="value">/path/to/example</span>
        <span class="directive">index</span> <span class="value">index.html</span>
    }
}

<span class="keyword">server</span> {
    <span class="directive">listen</span> <span class="value">80</span>
    <span class="directive">server_name</span> <span class="value">blog.example.com</span>
    <span class="directive">root</span> <span class="value">/path/to/blog</span>

    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/</span>
        <span class="directive">root</span> <span class="value">/path/to/blog</span>
        <span class="directive">index</span> <span class="value">index.html</span>
    }
}

<span class="keyword">server</span> {
    <span class="directive">listen</span> <span class="value">8080</span>
    <span class="directive">server_name</span> <span class="value">admin.example.com</span>
    <span class="directive">root</span> <span class="value">/path/to/admin</span>

    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/</span>
        <span class="directive">root</span> <span class="value">/path/to/admin</span>
        <span class="directive">index</span> <span class="value">dashboard.html</span>
    }
}</code></pre>
            </section>

            <section class="config-section">
                <h3>HTTP Redirection Configuration</h3>
                <p>
                    Redirects allow you to forward clients from one URL to another, which is useful
                    for URL shortening, maintaining backward compatibility, or implementing URL canonical forms.
                </p>

                <pre><code><span class="comment"># Various redirection configurations</span>
<span class="keyword">server</span> {
    <span class="directive">listen</span> <span class="value">8080</span>
    <span class="directive">server_name</span> <span class="value">redirect.example.com</span>
    <span class="directive">root</span> <span class="value">/path/to/webroot</span>

    <span class="comment"># 301 Permanent Redirect</span>
    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/old-path</span>
        <span class="directive">return</span> <span class="value">301:/new-path</span>
    }

    <span class="comment"># 302 Temporary Redirect</span>
    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/temporary</span>
        <span class="directive">return</span> <span class="value">302:/under-construction</span>
    }

    <span class="comment"># 307 Temporary Redirect (preserves HTTP method)</span>
    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/upload-old</span>
        <span class="directive">methods</span> <span class="value">GET POST</span>
        <span class="directive">return</span> <span class="value">307:/upload-new</span>
    }

    <span class="comment"># 308 Permanent Redirect (preserves HTTP method)</span>
    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/api/v1</span>
        <span class="directive">methods</span> <span class="value">GET POST PUT DELETE</span>
        <span class="directive">return</span> <span class="value">308:/api/v2</span>
    }

    <span class="comment"># External Redirect</span>
    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/external</span>
        <span class="directive">return</span> <span class="value">302:https://example.org</span>
    }
}</code></pre>
            </section>

            <section class="config-section">
                <h3>Error Pages Configuration</h3>
                <p>
                    Custom error pages provide a better user experience when errors occur. Webserv allows
                    you to define custom error pages for different HTTP status codes.
                </p>

                <pre><code><span class="keyword">server</span> {
    <span class="directive">listen</span> <span class="value">8080</span>
    <span class="directive">server_name</span> <span class="value">example.com</span>
    <span class="directive">root</span> <span class="value">/path/to/webroot</span>

    <span class="comment"># Define custom error pages</span>
    <span class="directive">error_pages</span> <span class="value">404:/errors/404.html</span>
    <span class="directive">error_pages</span> <span class="value">500:/errors/500.html</span>
    <span class="directive">error_pages</span> <span class="value">403:/errors/forbidden.html</span>

    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/errors</span>
        <span class="directive">root</span> <span class="value">/path/to/webroot/errors</span>
        <span class="directive">methods</span> <span class="value">GET</span>
    }
}</code></pre>
            </section>

            <section class="config-section">
                <h3>Complete Example Configuration</h3>
                <p>
                    Below is a complete example configuration that demonstrates many features of Webserv,
                    including multiple servers, CGI, redirects, and custom error pages.
                </p>

                <pre><code><span class="comment"># Global configuration parameters</span>
<span class="directive">max_connections</span> <span class="value">100</span>
<span class="directive">max_concurrent_cgi</span> <span class="value">10</span>
<span class="directive">max_cgi_backlog</span> <span class="value">20</span>
<span class="directive">max_workers</span> <span class="value">4</span>
<span class="directive">client_body_size</span> <span class="value">10M</span>
<span class="directive">client_header_size</span> <span class="value">16K</span>
<span class="directive">timeout_keep_alive</span> <span class="value">5000</span>

<span class="comment"># Define global CGI handlers</span>
<span class="directive">cgi</span> <span class="value">.py:/usr/bin/python3</span>
<span class="directive">cgi</span> <span class="value">.php:/usr/bin/php-cgi</span>

<span class="comment"># Main server</span>
<span class="keyword">server</span> {
    <span class="directive">listen</span> <span class="value">80</span>
    <span class="directive">server_name</span> <span class="value">example.com www.example.com</span>
    <span class="directive">root</span> <span class="value">/path/to/webroot</span>
    <span class="directive">client_body_size</span> <span class="value">5M</span>
    <span class="directive">error_pages</span> <span class="value">404:/errors/404.html</span>
    <span class="directive">error_pages</span> <span class="value">500:/errors/500.html</span>

    <span class="comment"># Static files</span>
    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/</span>
        <span class="directive">root</span> <span class="value">/path/to/webroot</span>
        <span class="directive">methods</span> <span class="value">GET</span>
        <span class="directive">index</span> <span class="value">index.html</span>
        <span class="directive">auto_index</span> <span class="value">0</span>
    }

    <span class="comment"># Directory listing</span>
    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/files</span>
        <span class="directive">root</span> <span class="value">/path/to/webroot/files</span>
        <span class="directive">methods</span> <span class="value">GET</span>
        <span class="directive">auto_index</span> <span class="value">1</span>
    }

    <span class="comment"># CGI scripts</span>
    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/cgi-bin</span>
        <span class="directive">root</span> <span class="value">/path/to/webroot/cgi-bin</span>
        <span class="directive">methods</span> <span class="value">GET POST</span>
        <span class="directive">cgi</span> <span class="value">.py:/usr/bin/python3</span>
        <span class="directive">cgi</span> <span class="value">.php:/usr/bin/php-cgi</span>
    }

    <span class="comment"># File uploads</span>
    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/upload</span>
        <span class="directive">root</span> <span class="value">/path/to/webroot/upload</span>
        <span class="directive">methods</span> <span class="value">GET POST</span>
        <span class="directive">upload</span> <span class="value">1</span>
        <span class="directive">client_body_size</span> <span class="value">20M</span>
    }

    <span class="comment"># Redirects</span>
    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/old</span>
        <span class="directive">return</span> <span class="value">301:/new</span>
    }
}

<span class="comment"># API server</span>
<span class="keyword">server</span> {
    <span class="directive">listen</span> <span class="value">8080</span>
    <span class="directive">server_name</span> <span class="value">api.example.com</span>
    <span class="directive">root</span> <span class="value">/path/to/api</span>

    <span class="comment"># API endpoints handled by CGI</span>
    <span class="keyword">location</span> {
        <span class="directive">path</span> <span class="value">/v1</span>
        <span class="directive">root</span> <span class="value">/path/to/api/v1</span>
        <span class="directive">methods</span> <span class="value">GET POST PUT DELETE</span>
        <span class="directive">cgi</span> <span class="value">.py:/usr/bin/python3</span>
    }
}</code></pre>
            </section>
        </main>

        <aside>
            <section class="sidebar-section">
                <h3>Configuration Directives</h3>
                <p>Common directives used in Webserv configuration:</p>
                <ul>
                    <li><strong>listen</strong> - Specify IP address and port</li>
                    <li><strong>server_name</strong> - Domain names for this server</li>
                    <li><strong>root</strong> - Root directory for serving files</li>
                    <li><strong>cgi</strong> - Map file extensions to interpreters</li>
                    <li><strong>error_pages</strong> - Custom error pages</li>
                    <li><strong>client_body_size</strong> - Maximum upload size</li>
                    <li><strong>auto_index</strong> - Enable directory listing</li>
                </ul>
            </section>

            <section class="sidebar-section">
                <h3>CGI Environment Variables</h3>
                <p>Common environment variables set for CGI scripts:</p>
                <ul>
                    <li><strong>REQUEST_METHOD</strong> - HTTP method (GET, POST)</li>
                    <li><strong>QUERY_STRING</strong> - URL query parameters</li>
                    <li><strong>CONTENT_TYPE</strong> - Request content type</li>
                    <li><strong>CONTENT_LENGTH</strong> - Request body length</li>
                    <li><strong>HTTP_*</strong> - HTTP headers</li>
                    <li><strong>REMOTE_ADDR</strong> - Client IP address</li>
                </ul>
            </section>

            <section class="sidebar-section">
                <h3>Testing Your Configuration</h3>
                <p>After configuring your server, you can test the CGI functionality with our <a href="/cgi-bin/calculator.py">calculator demo</a>.</p>
                <p>Remember that the CGI interpreter paths must point to valid executables on your system.</p>
            </section>
        </aside>
    </div>

    <footer>
        <p>&copy; 2023 42 Webserv Project - Created by a team of three 42 students</p>
    </footer>

    <script>
        function switchTab(event, tabId) {
            // Hide all content
            const contents = document.getElementsByClassName('config-content');
            for (let i = 0; i < contents.length; i++) {
                contents[i].classList.remove('active');
            }

            // Remove active class from all tabs
            const tabs = document.getElementsByClassName('config-tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }

            // Show the selected content and mark tab as active
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
        }
    </script>
</body>
</html>